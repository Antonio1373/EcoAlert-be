openapi: 3.0.3
info:
  title: EcoAlert API
  version: 1.0.0
  description: API per la gestione utenti, autenticazione e home page

tags:
  - name: Segnalazioni
    description: Operazioni sulle segnalazioni ambientali
  - name: Enti
    description: Operazioni sugli enti
  - name: Auth
    description: Login e registrazione
  - name: Utenti
    description: Informazioni sugli utenti

paths:

  /segnalazioni/{idSegnalazione}/stato:
    put:
      tags:
        - Segnalazioni
      summary: Aggiorna lo stato di una segnalazione
      description: Permette a un ente di aggiornare lo stato di una segnalazione (da INSERITO a ELABORATO, SOSPESO o CHIUSO)
      operationId: updateSegnalazioneStatus
      parameters:
        - name: idSegnalazione
          in: path
          required: true
          schema:
            type: integer
        - name: idEnte
          in: query
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StatoUpdateInput'
      responses:
        '200':
          description: Stato aggiornato con successo
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SegnalazioneOutput'
        '400':
          description: Richiesta non valida
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Segnalazione o ente non trovati
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Errore interno
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /enti:
    get:
      tags:
        - Enti
      summary: Ottiene la lista di tutti gli enti
      operationId: getAllEnti
      responses:
        '200':
          description: Lista degli enti recuperata con successo
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/EnteOutput'
        '500':
          description: Errore interno
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /login:
    post:
      tags:
        - Auth
      summary: Effettua il login dell'utente
      operationId: login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginInput'
      responses:
        '200':
          description: Login effettuato
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginOutput'
        '401':
          description: Credenziali non valide
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Errore interno
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /sign-in:
    post:
      tags:
        - Auth
      summary: Registra un nuovo utente
      operationId: signIn
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UtenteInput'
      responses:
        '201':
          description: Utente creato
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UtenteOutput'
        '400':
          description: Dati non validi
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Errore interno
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /user/{id}:
    get:
      tags:
        - Utenti
      summary: Ottiene i dettagli di un utente
      operationId: getUserById
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: Utente trovato
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UtenteDettaglioOutput'
        '404':
          description: Utente non trovato
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Errore interno
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /user/{id}/segnalazioni:
    post:
      tags:
        - Segnalazioni
      summary: Crea una nuova segnalazione
      operationId: createSegnalazione
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/SegnalazioneInput'
      responses:
        '201':
          description: Segnalazione creata
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SegnalazioneOutput'
        '400':
          description: Dati non validi
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '404':
          description: Utente non trovato
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
        '500':
          description: Errore interno
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

components:
  schemas:
    EnteOutput:
      type: object
      properties:
        id:
          type: integer
        nomeEnte:
          type: string
        paese:
          type: string
        nazione:
          type: string
        email:
          type: string

    Error:
      type: object
      properties:
        code:
          type: integer
        message:
          type: string
        detail:
          type: string

    LoginInput:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
        password:
          type: string

    LoginOutput:
      type: object
      properties:
        userId:
          type: integer
        token:
          type: string
        ruolo:
          type: string

    SegnalazioneInput:
      type: object
      properties:
        descrizione:
          type: string
          description: Testo della segnalazione
        latitudine:
          type: number
          format: double
          x-java-type: java.lang.Double
          description: Latitudine della posizione della segnalazione
        longitudine:
          type: number
          format: double
          x-java-type: java.lang.Double
          description: Longitudine della posizione della segnalazione
        idEnte:
          type: integer
          description: ID dell'ente a cui associare la segnalazione
      required:
        - descrizione
        - latitudine
        - longitudine
        - idEnte

    SegnalazioneOutput:
      type: object
      properties:
        id:
          type: integer
          description: ID della segnalazione
        idUtente:
          type: integer
          description: ID del cittadino che ha creato la segnalazione
        idEnte:
          type: integer
          description: ID dell'ente associato alla segnalazione
        descrizione:
          type: string
          description: Testo della segnalazione
        latitudine:
          type: number
          format: double
          x-java-type: java.lang.Double
          description: Latitudine della segnalazione
        longitudine:
          type: number
          format: double
          x-java-type: java.lang.Double
          description: Longitudine della segnalazione
        stato:
          $ref: '#/components/schemas/StatoEnum'
          description: Stato della segnalazione

    UtenteDettaglioOutput:
      type: object
      properties:
        id:
          type: integer
        ruolo:
          type: string
        email:
          type: string
        nome:
          type: string
        cognome:
          type: string
        nomeEnte:
          type: string
        paese:
          type: string
        nazione:
          type: string

    UtenteInput:
      type: object
      properties:
        nome:
          type: string
        cognome:
          type: string
        email:
          type: string
        password:
          type: string
        paese:
          type: string
        nazione:
          type: string
        ruolo:
          type: string

    UtenteOutput:
      type: object
      properties:
        id:
          type: integer
        email:
          type: string
        ruolo:
          type: string

    StatoUpdateInput:
      type: object
      properties:
        stato:
          $ref: '#/components/schemas/StatoEnum'

    StatoEnum:
      type: string
      enum:
        - INSERITO
        - ELABORATO
        - SOSPESO
        - CHIUSO
