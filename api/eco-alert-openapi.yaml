openapi: 3.0.3
info:
  title: EcoAlert API
  version: 1.0.0
  description: API per la gestione utenti e autenticazione

paths:
  /sign-in:
    post:
      summary: Registra un nuovo utente
      description: Inserisce un nuovo utente nel database
      operationId: signIn
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UtenteInput'
      responses:
        '201':
          description: Utente creato con successo
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UtenteOutput'
        '400':
          description: Dati non validi
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                invalidInput:
                  summary: Errore di validazione
                  value:
                    message: "Invalid input data"
                    detail: "The email field must contain a valid address"
        '500':
          description: Errore interno del server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                serverError:
                  summary: Errore interno
                  value:
                    message: "Internal Server Error"
                    detail: "Unexpected exception during user registration"

  /login:
    post:
      summary: Effettua il login dell'utente
      description: Verifica le credenziali e restituisce un token di autenticazione
      operationId: login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginInput'
      responses:
        '200':
          description: Login effettuato con successo
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginOutput'
              examples:
                success:
                  summary: Login riuscito
                  value:
                    userId: "550e8400-e29b-41d4-a716-446655440000"
                    token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        '401':
          description: Credenziali non valide
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                unauthorized:
                  summary: Login fallito
                  value:
                    message: "Invalid credentials"
                    detail: "The provided email or password is incorrect"
        '500':
          description: Errore interno del server
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'
              examples:
                serverError:
                  summary: Errore interno
                  value:
                    message: "Internal Server Error"
                    detail: "Unexpected exception during login process"

components:
  schemas:
    UtenteInput:
      type: object
      required:
        - nome
        - cognome
        - email
        - password
      properties:
        nome:
          type: string
          example: Mario
        cognome:
          type: string
          example: Rossi
        email:
          type: string
          format: email
          example: mario.rossi@example.com
        password:
          type: string
          format: password
          example: mySecretPass123

    UtenteOutput:
      type: object
      properties:
        id:
          type: string
          example: "550e8400-e29b-41d4-a716-446655440000"
        nome:
          type: string
        cognome:
          type: string
        email:
          type: string

    LoginInput:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          example: mario.rossi@example.com
        password:
          type: string
          format: password
          example: mySecretPass123

    LoginOutput:
      type: object
      description: Risposta di successo per il login
      properties:
        userId:
          type: string
          example: "550e8400-e29b-41d4-a716-446655440000"
        token:
          type: string
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."

    Error:
      type: object
      description: Dettagli sull'errore restituito dall'API
      properties:
        message:
          type: string
          example: "User not found"
        detail:
          type: string
          example: "No user exists with the provided email address"
